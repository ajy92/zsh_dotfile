# ===========================================
# tmux configuration — Agent Workflow Optimized
# ===========================================

# --- 기본 설정 ---

# prefix: Ctrl+a (Ctrl+b보다 손에 가까움)
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# 256색 + true color 지원
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# 셸 기본값
set -g default-shell /bin/zsh

# 히스토리 버퍼
set -g history-limit 50000

# ESC 딜레이 제거 (vim/에디터 사용 시 중요)
set -sg escape-time 0

# 창/패인 인덱스 1부터 시작
set -g base-index 1
setw -g pane-base-index 1

# 창 닫으면 번호 재정렬
set -g renumber-windows on

# --- 마우스 지원 (매우 중요) ---

set -g mouse on

# 마우스 스크롤 시 자동으로 copy mode 진입
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t= \; send-keys -M

# --- 직관적 창 분할 ---

# v: 세로 분할 (좌|우)
bind v split-window -h -c "#{pane_current_path}"
# h: 가로 분할 (상/하)
bind h split-window -v -c "#{pane_current_path}"
# 기본 분할 키도 현재 경로 유지
unbind '"'
unbind %

# 새 윈도우도 현재 경로에서 열기
bind c new-window -c "#{pane_current_path}"

# --- 패인 이동 (Alt + 방향키, prefix 없이) ---

bind -n M-Left  select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up    select-pane -U
bind -n M-Down  select-pane -D

# --- 패인 크기 조절 (prefix + 방향키) ---

bind -r Left  resize-pane -L 5
bind -r Right resize-pane -R 5
bind -r Up    resize-pane -U 3
bind -r Down  resize-pane -D 3

# --- 윈도우 이동 (Shift + 좌우) ---

bind -n S-Left  previous-window
bind -n S-Right next-window

# --- 설정 리로드 ---

bind r source-file ~/.tmux.conf \; display-message "설정 리로드 완료!"

# --- 복사 모드 (vi 스타일) ---

setw -g mode-keys vi
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"

# --- 상태바 (모던 미니멀 테마) ---

set -g status-position bottom
set -g status-interval 5
set -g status-justify left

# 색상
set -g status-style "bg=#1e1e2e,fg=#cdd6f4"

# 좌측: 세션명
set -g status-left-length 30
set -g status-left "#[bg=#89b4fa,fg=#1e1e2e,bold] #S #[bg=default] "

# 우측: 호스트 | 날짜 시간
set -g status-right-length 60
set -g status-right "#[fg=#a6adc8] #H  #[fg=#89b4fa]%m/%d %H:%M "

# 윈도우 탭
setw -g window-status-format "#[fg=#6c7086]  #I:#W  "
setw -g window-status-current-format "#[bg=#313244,fg=#89b4fa,bold]  #I:#W  "

# 패인 테두리
set -g pane-border-style "fg=#313244"
set -g pane-active-border-style "fg=#89b4fa"

# 메시지 스타일
set -g message-style "bg=#89b4fa,fg=#1e1e2e,bold"
